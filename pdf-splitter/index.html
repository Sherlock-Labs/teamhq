<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Splitter — Sherlock Labs</title>
  <meta name="description" content="Split multi-page PDFs into individual pages. Free, private, runs entirely in your browser.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* --- Design Tokens --- */
    :root {
      --zinc-100: #f4f4f5;
      --zinc-200: #e4e4e7;
      --zinc-300: #d4d4d8;
      --zinc-400: #a1a1aa;
      --zinc-500: #71717a;
      --zinc-600: #52525b;
      --zinc-700: #3f3f46;
      --zinc-800: #27272a;
      --zinc-900: #18181b;
      --zinc-950: #09090b;
      --indigo-400: #818cf8;
      --indigo-500: #6366f1;
      --indigo-600: #4f46e5;
      --red-400: #f87171;
      --font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      --font-mono: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace;
    }

    /* --- Reset --- */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: var(--font-family);
      background: var(--zinc-950);
      color: var(--zinc-300);
      -webkit-font-smoothing: antialiased;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    a:focus-visible,
    button:focus-visible {
      outline: 2px solid var(--indigo-500);
      outline-offset: 2px;
      border-radius: 4px;
    }

    /* --- Container --- */
    .container {
      max-width: 720px;
      margin: 0 auto;
      padding-left: 20px;
      padding-right: 20px;
    }

    @media (min-width: 640px) {
      .container {
        padding-left: 32px;
        padding-right: 32px;
      }
    }

    /* --- Nav (matches TeamHQ pattern) --- */
    .nav {
      background: var(--zinc-950);
      border-bottom: 1px solid var(--zinc-800);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .nav__inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 0;
    }

    .nav__brand {
      display: flex;
      align-items: center;
    }

    .nav__title {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 0.05em;
      color: var(--zinc-100);
    }

    .nav__label {
      font-size: 14px;
      font-weight: 700;
      font-family: var(--font-mono);
      color: var(--zinc-400);
      margin-left: 8px;
      letter-spacing: 0.04em;
    }

    .nav__back {
      font-size: 14px;
      font-weight: 500;
      color: var(--zinc-400);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: color 0.15s ease;
    }

    .nav__back:hover {
      color: var(--zinc-200);
    }

    .nav__back-arrow {
      font-size: 16px;
    }

    /* --- Main --- */
    .main {
      flex: 1;
      padding: 32px 0;
    }

    /* --- Upload Zone --- */
    .upload-zone {
      border: 2px dashed var(--zinc-700);
      border-radius: 12px;
      padding: 64px 32px;
      background: var(--zinc-900);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      cursor: pointer;
      transition: border-color 0.15s ease, background-color 0.15s ease;
    }

    .upload-zone:focus-visible {
      outline: 2px solid var(--indigo-500);
      outline-offset: 2px;
      border-radius: 12px;
    }

    .upload-zone--dragover {
      border-color: var(--indigo-500);
      background: rgba(99, 102, 241, 0.05);
    }

    .upload-zone--dragover .upload-zone__icon {
      stroke: var(--indigo-500);
    }

    .upload-zone__icon {
      width: 48px;
      height: 48px;
      stroke: var(--zinc-600);
      fill: none;
      stroke-width: 1.5;
      stroke-linecap: round;
      stroke-linejoin: round;
      transition: stroke 0.15s ease;
    }

    .upload-zone__text {
      font-size: 18px;
      font-weight: 600;
      color: var(--zinc-300);
      margin-top: 16px;
    }

    .upload-zone__or {
      font-size: 14px;
      color: var(--zinc-600);
      margin: 8px 0;
    }

    .upload-zone__btn {
      background: var(--indigo-500);
      color: #fff;
      font-family: var(--font-family);
      font-size: 14px;
      font-weight: 600;
      padding: 8px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.15s ease;
    }

    .upload-zone__btn:hover {
      background: var(--indigo-400);
    }

    .upload-zone__hint {
      font-size: 12px;
      color: var(--zinc-600);
      margin-top: 16px;
    }

    /* Processing state */
    .processing {
      border: 2px dashed var(--zinc-700);
      border-radius: 12px;
      padding: 64px 32px;
      background: var(--zinc-900);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .processing-spinner {
      width: 24px;
      height: 24px;
      border: 3px solid var(--zinc-700);
      border-top-color: var(--indigo-500);
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .processing-text {
      font-size: 14px;
      color: var(--zinc-400);
      margin-top: 16px;
    }

    /* --- Error --- */
    .upload-error {
      background: rgba(248, 113, 113, 0.06);
      border: 1px solid rgba(248, 113, 113, 0.2);
      border-radius: 8px;
      padding: 12px 16px;
      margin-top: 16px;
    }

    .upload-error__text {
      font-size: 14px;
      color: var(--red-400);
      margin: 0;
    }

    /* --- Results --- */
    .pdf-info {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      padding: 16px 0;
      margin-bottom: 8px;
    }

    .pdf-info__name {
      font-size: 16px;
      font-weight: 600;
      color: var(--zinc-200);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 100%;
    }

    .pdf-info__meta {
      font-size: 14px;
      color: var(--zinc-400);
    }

    /* --- Actions Bar --- */
    .actions-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 0;
      margin-bottom: 24px;
      border-bottom: 1px solid var(--zinc-800);
    }

    .actions-bar__download-all {
      background: var(--indigo-500);
      color: #fff;
      font-family: var(--font-family);
      font-size: 14px;
      font-weight: 600;
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.15s ease;
    }

    .actions-bar__download-all:hover {
      background: var(--indigo-600);
    }

    .actions-bar__download-all:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .actions-bar__reset {
      background: transparent;
      border: 1px solid var(--zinc-700);
      color: var(--zinc-400);
      font-family: var(--font-family);
      font-size: 14px;
      font-weight: 500;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: border-color 0.15s ease, color 0.15s ease;
    }

    .actions-bar__reset:hover {
      border-color: var(--zinc-600);
      color: var(--zinc-300);
    }

    /* --- Page Grid --- */
    .page-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      list-style: none;
    }

    @media (min-width: 480px) {
      .page-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (min-width: 640px) {
      .page-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (min-width: 900px) {
      .page-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    /* --- Page Card --- */
    .page-card {
      background: var(--zinc-900);
      border: 1px solid var(--zinc-800);
      border-radius: 8px;
      padding: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      transition: border-color 0.15s ease;
    }

    .page-card:hover {
      border-color: var(--zinc-700);
    }

    .page-card__preview {
      width: 100%;
      aspect-ratio: 8.5 / 11;
      background: var(--zinc-800);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .page-card__preview canvas {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .page-card__preview-placeholder {
      color: var(--zinc-600);
      font-size: 12px;
    }

    .page-card__label {
      font-size: 14px;
      font-weight: 600;
      color: var(--zinc-200);
    }

    .page-card__download {
      font-size: 12px;
      font-weight: 500;
      color: var(--indigo-500);
      background: none;
      border: none;
      cursor: pointer;
      margin-top: 8px;
      font-family: var(--font-family);
      transition: color 0.15s ease;
    }

    .page-card__download:hover {
      color: var(--indigo-400);
      text-decoration: underline;
    }

    /* --- Footer --- */
    .footer {
      border-top: 1px solid var(--zinc-800);
      padding: 32px 0;
      text-align: center;
    }

    .footer__text {
      font-size: 14px;
      color: var(--zinc-600);
    }

    .footer__link {
      color: var(--zinc-500);
      text-decoration: none;
      transition: color 0.15s ease;
    }

    .footer__link:hover {
      color: var(--zinc-400);
    }

    /* --- Responsive --- */
    @media (max-width: 479px) {
      .upload-zone,
      .processing {
        padding: 48px 24px;
      }

      .actions-bar {
        flex-direction: column;
        gap: 8px;
      }

      .actions-bar__download-all,
      .actions-bar__reset {
        width: 100%;
        text-align: center;
      }
    }
  </style>
</head>
<body>

  <!-- Navigation -->
  <nav class="nav">
    <div class="container nav__inner">
      <div class="nav__brand">
        <span class="nav__title">PDF Splitter</span>
        <span class="nav__label">Sherlock Labs</span>
      </div>
      <a href="../index.html" class="nav__back">
        <span class="nav__back-arrow" aria-hidden="true">&larr;</span>
        TeamHQ
      </a>
    </div>
  </nav>

  <main class="main">
    <div class="container" id="app">

      <!-- Upload Zone -->
      <div class="upload-zone" id="upload-zone" role="button" tabindex="0" aria-label="Upload a PDF file">
        <svg class="upload-zone__icon" viewBox="0 0 48 48" aria-hidden="true">
          <path d="M28 4H12a4 4 0 0 0-4 4v32a4 4 0 0 0 4 4h24a4 4 0 0 0 4-4V16L28 4z"/>
          <polyline points="28 4 28 16 40 16"/>
          <line x1="24" y1="34" x2="24" y2="22"/>
          <polyline points="18 28 24 22 30 28"/>
        </svg>
        <p class="upload-zone__text">Drop a PDF here</p>
        <p class="upload-zone__or">or</p>
        <button class="upload-zone__btn" type="button" id="browse-btn">Browse Files</button>
        <p class="upload-zone__hint">PDF files only</p>
        <input type="file" accept=".pdf,application/pdf" id="file-input" hidden>
      </div>

      <!-- Error -->
      <div class="upload-error" id="upload-error" hidden role="alert">
        <p class="upload-error__text" id="error-text"></p>
      </div>

      <!-- Results (rendered by JS) -->
      <div id="results" hidden></div>

    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <p class="footer__text">A <a href="../index.html" class="footer__link">Sherlock Labs</a> tool</p>
    </div>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script src="https://unpkg.com/jszip@3.10.1/dist/jszip.min.js"></script>
  <script>
    (function () {
      'use strict';

      // Configure pdf.js worker
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

      var uploadZone = document.getElementById('upload-zone');
      var browseBtn = document.getElementById('browse-btn');
      var fileInput = document.getElementById('file-input');
      var errorContainer = document.getElementById('upload-error');
      var errorText = document.getElementById('error-text');
      var resultsContainer = document.getElementById('results');
      var appContainer = document.getElementById('app');

      var pdfLibDoc = null;   // pdf-lib document for splitting
      var pdfJsDoc = null;    // pdf.js document for rendering previews
      var pdfBytes = null;
      var originalFilename = '';

      // --- Upload Zone Events ---

      uploadZone.addEventListener('click', function (e) {
        if (e.target === browseBtn || browseBtn.contains(e.target)) return;
        fileInput.click();
      });

      uploadZone.addEventListener('keydown', function (e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          fileInput.click();
        }
      });

      browseBtn.addEventListener('click', function (e) {
        e.stopPropagation();
        fileInput.click();
      });

      fileInput.addEventListener('change', function () {
        if (fileInput.files.length > 0) {
          handleFile(fileInput.files[0]);
        }
      });

      // --- Drag and Drop ---

      uploadZone.addEventListener('dragenter', function (e) {
        e.preventDefault();
        uploadZone.classList.add('upload-zone--dragover');
      });

      uploadZone.addEventListener('dragover', function (e) {
        e.preventDefault();
        uploadZone.classList.add('upload-zone--dragover');
      });

      uploadZone.addEventListener('dragleave', function (e) {
        e.preventDefault();
        uploadZone.classList.remove('upload-zone--dragover');
      });

      uploadZone.addEventListener('drop', function (e) {
        e.preventDefault();
        uploadZone.classList.remove('upload-zone--dragover');
        if (e.dataTransfer.files.length > 0) {
          handleFile(e.dataTransfer.files[0]);
        }
      });

      // --- File Handling ---

      function handleFile(file) {
        hideError();

        if (file.type !== 'application/pdf' && !file.name.toLowerCase().endsWith('.pdf')) {
          showError("That doesn't look like a PDF. Please upload a .pdf file.");
          return;
        }

        originalFilename = file.name;
        var fileSizeStr = formatFileSize(file.size);

        showProcessing();

        var reader = new FileReader();
        reader.onload = function () {
          pdfBytes = new Uint8Array(reader.result);
          loadPdf(pdfBytes, fileSizeStr);
        };
        reader.onerror = function () {
          showUploadZone();
          showError("This PDF couldn't be read. The file may be corrupted.");
        };
        reader.readAsArrayBuffer(file);
      }

      async function loadPdf(bytes, fileSizeStr) {
        try {
          // Load with pdf-lib for splitting
          pdfLibDoc = await PDFLib.PDFDocument.load(bytes, { ignoreEncryption: true });
        } catch (err) {
          showUploadZone();
          if (err.message && err.message.toLowerCase().includes('encrypt')) {
            showError('Password-protected PDFs are not supported.');
          } else {
            showError("This PDF couldn't be read. The file may be corrupted.");
          }
          return;
        }

        var pageCount = pdfLibDoc.getPageCount();

        if (pageCount === 0) {
          showUploadZone();
          showError('This PDF has no pages.');
          return;
        }

        // Load with pdf.js for rendering previews
        try {
          pdfJsDoc = await pdfjsLib.getDocument({ data: bytes.slice(0) }).promise;
        } catch (err) {
          // If pdf.js fails, we still show results but without previews
          pdfJsDoc = null;
        }

        showResults(pageCount, fileSizeStr);
      }

      // --- UI State ---

      function showProcessing() {
        uploadZone.hidden = true;
        resultsContainer.hidden = true;
        hideError();

        // Insert processing indicator
        var proc = document.createElement('div');
        proc.className = 'processing';
        proc.id = 'processing';
        proc.innerHTML =
          '<div class="processing-spinner"></div>' +
          '<p class="processing-text">Processing PDF\u2026</p>';
        appContainer.insertBefore(proc, errorContainer);
      }

      function removeProcessing() {
        var proc = document.getElementById('processing');
        if (proc) proc.remove();
      }

      function showUploadZone() {
        removeProcessing();
        uploadZone.hidden = false;
        resultsContainer.hidden = true;
        fileInput.value = '';
      }

      function showResults(pageCount, fileSizeStr) {
        removeProcessing();
        uploadZone.hidden = true;
        resultsContainer.hidden = false;

        var baseName = stripPdfExtension(originalFilename);

        resultsContainer.innerHTML =
          '<div class="pdf-info">' +
            '<span class="pdf-info__name" title="' + escapeAttr(originalFilename) + '">' + escapeHTML(originalFilename) + '</span>' +
            '<span class="pdf-info__meta">' + pageCount + (pageCount === 1 ? ' page' : ' pages') + ' \u00B7 ' + fileSizeStr + '</span>' +
          '</div>' +
          '<div class="actions-bar">' +
            '<button class="actions-bar__download-all" id="download-all-btn" type="button">Download All as ZIP</button>' +
            '<button class="actions-bar__reset" id="reset-btn" type="button">Upload Another</button>' +
          '</div>' +
          '<ol class="page-grid" id="page-grid" role="list"></ol>';

        var pageGrid = document.getElementById('page-grid');
        renderPageGrid(pageGrid, pageCount, baseName);

        // Bind buttons
        document.getElementById('download-all-btn').addEventListener('click', handleDownloadAll);
        document.getElementById('reset-btn').addEventListener('click', handleReset);

        // Bind individual downloads via delegation
        pageGrid.addEventListener('click', function (e) {
          var btn = e.target.closest('.page-card__download');
          if (!btn) return;
          var pageIndex = parseInt(btn.getAttribute('data-page'), 10);
          downloadSinglePage(pageIndex, baseName);
        });
      }

      function renderPageGrid(grid, pageCount, baseName) {
        for (var i = 0; i < pageCount; i++) {
          var pageNum = i + 1;
          var li = document.createElement('li');
          li.className = 'page-card';
          li.innerHTML =
            '<div class="page-card__preview" id="preview-' + i + '">' +
              '<span class="page-card__preview-placeholder">\u2026</span>' +
            '</div>' +
            '<span class="page-card__label">Page ' + pageNum + '</span>' +
            '<button class="page-card__download" type="button" ' +
              'data-page="' + i + '" ' +
              'aria-label="Download page ' + pageNum + ' as PDF">' +
              'Download</button>';
          grid.appendChild(li);

          // Render preview async
          renderPreview(i);
        }
      }

      async function renderPreview(pageIndex) {
        if (!pdfJsDoc) return;

        try {
          var page = await pdfJsDoc.getPage(pageIndex + 1);
          var viewport = page.getViewport({ scale: 1 });

          // Scale to fit a reasonable preview width
          var previewWidth = 200;
          var scale = previewWidth / viewport.width;
          var scaledViewport = page.getViewport({ scale: scale });

          var canvas = document.createElement('canvas');
          canvas.width = scaledViewport.width;
          canvas.height = scaledViewport.height;

          var ctx = canvas.getContext('2d');
          await page.render({ canvasContext: ctx, viewport: scaledViewport }).promise;

          var container = document.getElementById('preview-' + pageIndex);
          if (container) {
            container.innerHTML = '';
            container.appendChild(canvas);
          }
        } catch (err) {
          // Silently fail — preview is nice-to-have
        }
      }

      // --- Download Handlers ---

      async function downloadSinglePage(pageIndex, baseName) {
        var filename = baseName + '-page-' + (pageIndex + 1) + '.pdf';
        var pageBytes = await extractPage(pageIndex);
        triggerDownload(pageBytes, filename, 'application/pdf');
      }

      async function handleDownloadAll() {
        if (!pdfLibDoc) return;

        var btn = document.getElementById('download-all-btn');
        btn.textContent = 'Preparing ZIP\u2026';
        btn.disabled = true;

        try {
          var zip = new JSZip();
          var baseName = stripPdfExtension(originalFilename);
          var pageCount = pdfLibDoc.getPageCount();

          for (var i = 0; i < pageCount; i++) {
            var pageBytes = await extractPage(i);
            zip.file(baseName + '-page-' + (i + 1) + '.pdf', pageBytes);
          }

          var zipBlob = await zip.generateAsync({ type: 'blob' });
          triggerDownload(zipBlob, baseName + '-pages.zip', 'application/zip');
        } catch (err) {
          // Restore button on failure
        }

        btn.textContent = 'Download All as ZIP';
        btn.disabled = false;
      }

      function handleReset() {
        pdfLibDoc = null;
        pdfJsDoc = null;
        pdfBytes = null;
        originalFilename = '';
        hideError();
        showUploadZone();
      }

      // --- Helpers ---

      async function extractPage(pageIndex) {
        var newDoc = await PDFLib.PDFDocument.create();
        var copiedPages = await newDoc.copyPages(pdfLibDoc, [pageIndex]);
        newDoc.addPage(copiedPages[0]);
        return await newDoc.save();
      }

      function triggerDownload(data, filename, mimeType) {
        var blob = data instanceof Blob ? data : new Blob([data], { type: mimeType });
        var url = URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        setTimeout(function () { URL.revokeObjectURL(url); }, 1000);
      }

      function showError(message) {
        errorText.textContent = message;
        errorContainer.hidden = false;
      }

      function hideError() {
        errorContainer.hidden = true;
        errorText.textContent = '';
      }

      function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + ' B';
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
        return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
      }

      function stripPdfExtension(filename) {
        return filename.replace(/\.pdf$/i, '');
      }

      function escapeHTML(str) {
        var div = document.createElement('div');
        div.appendChild(document.createTextNode(str));
        return div.innerHTML;
      }

      function escapeAttr(str) {
        return str.replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
      }
    })();
  </script>
</body>
</html>
